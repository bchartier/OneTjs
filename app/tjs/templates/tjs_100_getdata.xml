<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<GDAS service="TJS"
      version="1.0"
      capabilities="{{ get_service_url(serv=service) }}"
      xml:lang="{{ service.languages[0] }}"
      xmlns:tjs="http://www.opengis.net/tjs/1.0"
      xmlns:ows="http://www.opengis.net/ows/1.1"
      xmlns:xlink="http://www.w3.org/1999/xlink"
      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
      xsi:schemaLocation="http://www.opengis.net/tjs/1.0 http://schemas.opengis.net/tjs/1.0/tjsGetData_response.xsd">
    <tjs:Framework>
        <tjs:FrameworkURI>{{ framework.uri }}</tjs:FrameworkURI>
        <tjs:Organization>{{ framework.organization }}</tjs:Organization>
        <tjs:Title>{{ framework.title }}</tjs:Title>
        <tjs:Abstract>{{ framework.abstract }}</tjs:Abstract>
        <tjs:ReferenceDate startDate="{{ framework.reference_date }}">{{ framework.start_date }}</tjs:ReferenceDate>
        <tjs:Version>{{ framework.version }}</tjs:Version>
{% if framework.documentation is not none %}
        <tjs:Documentation>{{ framework.documentation }}</tjs:Documentation>
{% endif %}
        <tjs:FrameworkKey>
            <tjs:Column name="{{ framework.key_col['name']}}" type="{{ framework.key_col['type'] }}" length="{{ framework.key_col['length'] }}" decimals="{{ framework.key_col['decimals'] }}" />
        </tjs:FrameworkKey>
        <tjs:BoundingCoordinates>
            <tjs:North>{{ framework.bbox["north"] }}</tjs:North>
            <tjs:South>{{ framework.bbox["south"] }}</tjs:South>
            <tjs:East>{{ framework.bbox["east"] }}</tjs:East>
            <tjs:West>{{ framework.bbox["west"] }}</tjs:West>
        </tjs:BoundingCoordinates>
        <tjs:DescribeDatasetsRequest xlink:href="{{ get_describedatasets_url(serv=service, tjs_version=tjs_version, dataset=dataset) }}"/>
        <tjs:Dataset>
            <tjs:DatasetURI>{{ dataset.uri }}</tjs:DatasetURI>
            <tjs:Organization>{{ dataset.organization }}</tjs:Organization>
            <tjs:Title>{{ dataset.title }}</tjs:Title>
            <tjs:Abstract>{{ dataset.abstract }}</tjs:Abstract>
            <tjs:ReferenceDate>{{ dataset.reference_date }}</tjs:ReferenceDate>
            <tjs:Version>{{ dataset.version }}</tjs:Version>
{% if dataset.documentation is not none %}
            <tjs:Documentation>{{ dataset.documentation }}</tjs:Documentation>
{% endif %}
            <tjs:DescribeDataRequest xlink:href="{{ get_describedata_url(serv=service, tjs_version=tjs_version, dataset=dataset) }}"/>
            <tjs:Columnset>
                <!--Need a loop on all framework keys of the dataset?-->
                <tjs:FrameworkKey complete="{% if dataset.framework_complete %}true{% else %}false{% endif %}" relationship="{{ dataset.framework_relationship }}">
                    <tjs:Column name="{{ framework.key_col['name']}}" type="{{ framework.key_col['type'] }}" length="{{ framework.key_col['length'] }}" decimals="{{ framework.key_col['decimals'] }}" />
                </tjs:FrameworkKey>
                <tjs:Attributes>
{% for attribute in attributes %}
                    <tjs:Column name="{{ attribute.name }}" type="http://www.w3.org/TR/xmlschema-2/#integer" length="10" decimals="0" purpose="Attribute">
                        <tjs:Title>{{ attribute.title }}</tjs:Title>
                        <tjs:Abstract>{{ attribute.abstract }}</tjs:Abstract>
                        <!--Documentation>{{ attribute.documentation }}</Documentation-->
                        <tjs:Values>
{{ attribute.values }}
                        </tjs:Values>
                        <tjs:GetDataRequest xlink:href="{{ get_getdata_url(serv=service, tjs_version=tjs_version, dataset=dataset, attribute=attribute) }}"/>
                    </tjs:Column>
{% endfor %}
                </tjs:Attributes>
            </tjs:Columnset>
            <tjs:Rowset>
{% for row in data.itertuples() %}
                <tjs:Row>
                    <tjs:K>{{ row[0] }}</tjs:K>
{% for col in data.columns %}
                    <tjs:V>{{ row[col] }}</tjs:V>
{% endfor %}
                </tjs:Row>
{% endfor %}
            </tjs:Rowset>
        </tjs:Dataset>
    </tjs:Framework>
</GDAS>
